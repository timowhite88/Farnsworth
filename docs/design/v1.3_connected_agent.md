# Design: The Connected Agent (v1.3.0)

## Overview

This design proposes effectively merging the "Getting Things Done" (GSD) context-engineering framework with the "Clawdbot" omni-channel connectivity model to create **Farnsworth v1.3.0**.

The goal is to move from a "tool" that you run in a terminal to a "connected agent" that lives in your project and communicates with you anywhere.

## 1. The GSD Workflow Engine ("Deep Focus Mode")

We will adopt the GSD philosophy—structured state management to prevent context rot—but automate it using our Agent Swarm.

### 1.1 Automated State Sync
Instead of the user manually writing `PROJECT.md` or `STATE.md`, the `ProjectTracker` (from v1.2.0) will be upgraded to automatically maintain these files.

- **`PROJECT.md`**: High-level vision, goals, and architecture. Managed by the **Project Manager Agent** (new role for Planner).
- **`ROADMAP.md`**: Milestones and future plans. Auto-synced with the `Milestone` objects in `ProjectTracker`.
- **`STATE.md`**: The "Scratchpad" for the current session. Contains:
  - Current Objective
  - Active Task
  - Recent Decisions
  - Blockers

### 1.2 "Context Injection" Protocol
When the user queries Farnsworth, we will implement a dynamic context injector that reads these artifacts and prepends them to the system prompt in an XML structure (à la GSD).

```xml
<project_context>
  <vision>...</vision>
  <current_state>...</current_state>
  <active_task>...</active_task>
</project_context>
```

This ensures that even after 100 turns of conversation, the agent "remembers" the exact state of the project without hallucinations.

## 2. Omni-Channel Messaging Bridge ("ChatOps")

We will implement a modular messaging interface that allows `Farnsworth` to operate headlessly and communicate via external platforms.

### 2.1 Architecture
`farnsworth/interfaces/messaging.py`

- **`MessagingProvider`**: Abstract base class for adapters (Discord, Slack, Matrix).
- **`MessageRouter`**: Routes incoming messages to the appropriate internal agent (Planner, Web, etc.).
- **`NotificationCenter`**: Pushes proactive alerts (e.g., "Task Completed", "Build Failed") to the user's preferred channel.

### 2.2 Proactive Suggestions
Leveraging v0.5.0's "Anticipatory Suggestions", the Messaging Bridge will push these suggestions to the user.

*Example:*
> **Farnsworth (Discord)**: "I noticed you just committed a change to `planner_agent.py`. Would you like me to run the test suite and report back?"

## 3. Implementation Plan

### Phase 1: GSD Context Engine
1. Update `ProjectTracker` to write/sync `PROJECT.md`, `ROADMAP.md`, `STATE.md`.
2. Create `ContextInjector` class to format these files into XML context.
3. Integrate with `PlannerAgent` to update `STATE.md` on every task transition.

### Phase 2: Messaging Framework
1. Create `farnsworth/interfaces/messaging` package.
2. Implement `DiscordAdapter` (using `discord.py` patterns, but kept generic).
3. Connect `PlannerAgent` events (`on_task_complete`) to the `NotificationCenter`.

### Phase 3: "Live Canvas" Dashboard
1. Update Streamlit dashboard to render the live `STATE.md` and `ROADMAP.md`.
2. Allow "ChatOps" style commands from the dashboard.

## Novelty & Innovation

- **vs GSD**: GSD is manual; Farnsworth is fully autonomous. You don't write the state; the agent does.
- **vs Clawdbot**: Clawdbot is a chatbot; Farnsworth is a *development environment*. We bring the chat *to* the code.
